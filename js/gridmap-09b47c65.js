!function(){window.Gridmap=function(){function t(t){var e=this;this.element=t,this.svg=d3.select(this.element).append("svg").attr("width",this.width),this.block_width=(this.width-200)/App.years.length,this.yearTitles=this.svg.append("g").attr("class","year-title").attr("transform","translate(100,0)"),this.yearTitles.selectAll("text").data(App.years).enter().append("text").text(function(t){return t}).attr("x",function(t,r){return(r+.5)*e.block_width}),this.leftNames=this.svg.append("g").attr("class","left-text").attr("transform","translate(90, "+this.top_margin+")"),this.rightNames=this.svg.append("g").attr("class","right-text").attr("transform","translate("+(this.width-90)+","+this.top_margin+")"),this.grid=this.svg.append("g").attr("class","grid").attr("transform","translate(100,"+this.top_margin+")"),_(App.years).each(function(t,r){return e.grid.append("g").attr("data-year",t).attr("transform","translate("+r*e.block_width+", 0)")})}return t.prototype.width=940,t.prototype.block_height=20,t.prototype.top_margin=20,t.prototype.updateData=function(t,e){var r,a,n=this;return this.data=t,this.color=null!=e?e:"#000",this.svg.attr("height",this.data.length*this.block_height+this.top_margin),this.shade=d3.scale.linear().range(["#fff",this.color]),r=this.leftNames.selectAll("text").data(this.data,function(t){return t.name}),r.enter().append("text"),r.exit().remove(),r.text(function(t){return t.name}).attr("y",function(t,e){return(e+.5)*n.block_height}).style("fill",this.color),a=this.rightNames.selectAll("text").data(this.data,function(t){return t.name}),a.enter().append("text"),a.exit().remove(),a.text(function(t){return t.name}).attr("y",function(t,e){return(e+.5)*n.block_height}).style("fill",this.color),_(App.years).each(function(t){var e,r;return n.shade.domain(d3.extent(_(n.data).collect(function(e){var r;return null!=(r=e[t])?r.number:void 0}))),e=d3.select("[data-year='"+t+"']").selectAll("g").data(n.data,function(t){return t.name}),r=e.enter().append("g"),r.append("rect"),r.append("title"),r.append("text").attr("class","rank_status"),e.exit().remove(),e.attr("transform",function(t,e){return"translate(0, "+n.block_height*e+")"}),e.select("rect").attr("height",n.block_height).attr("width",n.block_width).style("fill",function(e){return null!=e[t]?n.shade(e[t].number):"#fff"}),e.select("title").text(function(e){return n.tooltip(e,t)}),e.select("text.rank_status").text(function(e){var r;return 1===(null!=(r=e[t])?r.rank:void 0)?"â˜…":""}).attr("x",function(){return n.block_width/2}).attr("y",function(){return n.block_height/2})})},t.prototype.tooltip=function(t,e){var r;return r=null!=t[e]?"Rank: "+t[e].rank+" - Number: "+t[e].number:"Outside top 100",""+e+" - "+r},t}()}.call(this);