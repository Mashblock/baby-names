!function(){window.Gridmap=function(){function t(t){var e=this;this.element=t,this.svg=d3.select(this.element).append("svg").attr("width",this.width),this.block_width=(this.width-200)/App.years.length,this.yearTitles=this.svg.append("g").attr("class","year-title").attr("transform","translate(100,0)"),this.yearTitles.selectAll("text").data(App.years).enter().append("text").text(function(t){return t}).attr("x",function(t,a){return(a+.5)*e.block_width}),this.paper=this.svg.append("g").attr("transform","translate(0,"+this.top_margin+")")}return t.prototype.width=940,t.prototype.block_height=20,t.prototype.top_margin=20,t.prototype.template=_.template("<strong>Rank:</strong> <%= rank %><br />\n<strong>Number:</strong> <%= number %><br />"),t.prototype.updateData=function(t,e){var a,r,n=this;return this.data=t,this.color=null!=e?e:"#000",this.svg.attr("height",this.data.length*this.block_height+this.top_margin),this.shades={},_(App.years).each(function(t){return n.shades[t]=d3.scale.linear().range(["#fff",n.color]).domain(d3.extent(_(n.data).collect(function(e){var a;return null!=(a=e[t])?a.number:void 0})))}),r=this.paper.selectAll("g.row").data(this.data,function(t){return t.name}),a=r.enter().append("g").attr("class","row"),a.append("text").attr("class","left-text").attr("y",this.block_height/2).attr("transform","translate(90, 0)"),a.append("text").attr("class","right-text").attr("y",this.block_height/2).attr("transform","translate("+(this.width-90)+",0)"),_(App.years).each(function(t,e){var r;return r=a.append("g").attr("data-year",t).attr("transform","translate("+(n.block_width*e+100)+",0)"),r.append("rect").attr("height",n.block_height).attr("width",n.block_width),r.append("title"),r.append("text").attr("class","rank_status").attr("x",function(){return n.block_width/2}).attr("y",function(){return n.block_height/2})}),r.exit().remove(),r.attr("transform",function(t,e){return"translate(0, "+e*n.block_height+")"}),r.select("text.left-text").text(function(t){return t.name}).style("fill",this.color),r.select("text.right-text").text(function(t){return t.name}).style("fill",this.color),_(App.years).each(function(t){var e;return e=r.selectAll("g[data-year='"+t+"']"),e.selectAll("rect").style("fill",function(e){return null!=e[t]?n.shades[t](e[t].number):"#fff"}).attr("data-toggle","popover").attr("data-trigger","hover").attr("data-container","body").attr("data-placement","top").attr("data-html","true").attr("data-title",function(e){return""+e.name+" - "+t}).attr("data-content",function(e){return n.tooltip(e,t)}),e.selectAll("text.rank_status").text(function(e){var a;return 1===(null!=(a=e[t])?a.rank:void 0)?"â˜…":""})}),$("[data-toggle=popover]").popover()},t.prototype.tooltip=function(t,e){return null!=t[e]?this.template(t[e]):"Outside top 100"},t}()}.call(this),function(){top!==self&&top.location.replace(self.location.href),window.App={years:[1999,2e3,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012],data:{},colors:{girls:"#a04",boys:"#04a"}},$(document).ready(function(){return Modernizr.svg?(App.gridmap=new Gridmap(document.getElementById("graph")),App.showSex("boys"),$("#genders a").click(function(){return App.showSex($(this).data("gender")),!1})):void 0}),App.showSex=function(t){var e;return NProgress.start(),$("#genders li").removeClass("active"),$("#genders li."+t).addClass("active"),e=App.colors[t],App.data[t]?(App.gridmap.updateData(App.data[t],e),NProgress.done()):d3.csv("data/"+t+".csv").get(function(a,r){var n;return n={},_(r).forEach(function(t){var e;return null==n[e=t.name]&&(n[e]={}),n[t.name][parseInt(t.year)]={number:parseInt(t.number),rank:parseInt(t.rank),notes:t.notes}}),App.data[t]=_(n).chain().collect(function(t,e){return _(t).extend({name:e})}).sortBy(function(t){return t.name}).value(),App.gridmap.updateData(App.data[t],e),NProgress.done()})}}.call(this);