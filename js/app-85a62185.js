!function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};window.Gridmap=function(){function e(e){this.element=e,this.onResize=t(this.onResize,this),this.setMedia=t(this.setMedia,this),this.svg=d3.select(this.element).append("svg"),this.yearTitles=this.svg.append("g").attr("class","year-title").attr("transform","translate(100,0)"),this.yearTitles.selectAll("text").data(App.years).enter().append("text"),this.width_scale=d3.scale.ordinal().domain(App.years),this.paper=this.svg.append("g"),$(window).on("snap",this.setMedia),$(window).on("resize",this.onResize),$(window).trigger("resize")}return e.prototype.block_height=20,e.prototype.top_margin=20,e.prototype.tooltip=_.template("<strong>Rank:</strong> <%= rank %><br />\n<strong>Number:</strong> <%= number %><br />"),e.prototype.setMedia=function(t,e){return this.media=function(){switch(e.minWidth){case 0:return"xs";case 768:return"sm";case 992:return"md";case 1200:return"lg"}}(),this.svg.attr("data-media",this.media)},e.prototype.onResize=function(){return"xs"===this.media||this.previous_media!==this.media?(this.redraw(),this.previous_media=this.media):void 0},e.prototype.setShades=function(){var t=this;return this.shades={},this.year_data=d3.nest().key(function(t){return t.year}).entries(this.data),this.year_data.forEach(function(e){return t.shades[e.key]=d3.scale.linear().range(["#fff",t.color]).domain(d3.extent(_(e.values).collect(function(t){return parseInt(t.number,10)})))})},e.prototype.redraw=function(){var t,e,a,r,s=this;return this.width=parseInt(d3.select(this.element).style("width"),10),r="xs"===this.media?40:20,this.svg.attr("width",this.width),this.paper.attr("transform","translate(0,"+r+")"),e="xs"===this.media?this.width-120:this.width-200,this.width_scale.rangeRoundBands([0,e],0),this.yearTitles.selectAll("text").text(function(t){return t}),a=this.paper.selectAll("g.row"),a.attr("transform",function(t,e){return"translate(0, "+e*s.block_height+")"}),a.selectAll("text.left-text").text(function(t){return t.key}).style("fill",this.color).attr("y",this.block_height/2).attr("transform","translate(90, 0)"),a.selectAll("text.right-text").text(function(t){return t.key}).style("fill",this.color).attr("y",this.block_height/2).attr("transform","translate("+(this.width-90)+",0)"),t=a.selectAll("g.cell"),t.attr("transform",function(t){return"translate("+(s.width_scale(t.key)+100)+",0)"}).attr("data-toggle","popover").attr("data-trigger","hover").attr("data-container","body").attr("data-placement","top").attr("data-html","true").attr("data-title",function(t){return""+t.values[0].name+" - "+t.values[0].year}).attr("data-content",function(t){return s.tooltip(t.values[0])}),t.selectAll("rect").attr("height",this.block_height).attr("width",this.width_scale.rangeBand()).style("fill",function(t){return s.shades[t.key](parseInt(t.values[0].number,10))}),t.selectAll("text.rank_status").text(function(t){return 1===parseInt(t.values[0].rank,10)?"â˜…":""}).attr("x",this.width_scale.rangeBand()/2).attr("y",this.block_height/2),$("[data-toggle=popover]").popover(),"xs"===this.media?(a.selectAll("text.right-text").style("visibility","hidden"),this.yearTitles.selectAll("text").attr("transform",function(t){return"translate("+(s.width_scale(t)+s.width_scale.rangeBand()/2)+", 20)rotate(90)"}).style("dominant-baseline","middle")):(a.selectAll("text.right-text").style("visibility","visible"),this.yearTitles.selectAll("text").attr("transform",function(t){return"translate("+(s.width_scale(t)+s.width_scale.rangeBand()/2)+", 0)"}).style("dominant-baseline","hanging"))},e.prototype.updateData=function(t,e){var a,r,s,n,i;return this.data=t,this.color=null!=e?e:"#000",this.setShades(),r=d3.nest().key(function(t){return t.name}).sortKeys(d3.ascending).key(function(t){return t.year}).sortKeys(d3.ascending).entries(this.data),this.svg.attr("height",r.length*this.block_height+this.top_margin),i=this.paper.selectAll("g.row").data(r,function(t){return t.key}),n=i.enter().append("g").attr("class","row"),n.append("text").attr("class","left-text"),n.append("text").attr("class","right-text"),i.exit().remove(),a=i.selectAll("g.cell").data(function(t){return t.values},function(t){return t.key}),s=a.enter().append("g").attr("class","cell"),s.append("rect"),s.append("text").attr("class","rank_status"),a.exit().remove(),this.redraw()},e}()}.call(this),function(){top!==self&&top.location.replace(self.location.href),window.App={years:[1999,2e3,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014],data:{},colors:{girls:"#a04",boys:"#04a"}},$(document).ready(function(){return Modernizr.svg?(App.gridmap=new Gridmap(document.getElementById("graph")),App.showSex("boys"),$("#genders a").click(function(){return App.showSex($(this).data("gender")),!1}),$.rubberband({minWidth:[768,992,1200]})):void 0}),App.showSex=function(t){var e;return NProgress.start(),$("#genders li").removeClass("active"),$("#genders li."+t).addClass("active"),e=App.colors[t],App.gridmap.updateData([],e),App.data[t]?(App.gridmap.updateData(App.data[t],e),NProgress.done()):d3.csv("data/"+t+".csv").get(function(a,r){return App.data[t]=r,App.gridmap.updateData(App.data[t],e),NProgress.done()})}}.call(this);